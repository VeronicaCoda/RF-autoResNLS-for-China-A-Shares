# RF-autoResNLS ä»£ç å®ç°è¯´æ˜

> **é¡¹ç›®è¯´æ˜**ï¼šæœ¬é¡¹ç›®åŒ…å« **RF-autoResNLS** æ¨¡å‹çš„ PyTorch å®ç°ä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªæ··åˆæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œç»“åˆäº† **ResNet**ã€**BiLSTM** å’Œ **Random Forest**ï¼ˆéšæœºæ£®æ—ï¼‰çš„è‡ªé€‚åº”æƒé‡æœºåˆ¶ï¼Œç”¨äºè‚¡ç¥¨æ”¶ç›˜ä»·çš„æ—¶é—´åºåˆ—é¢„æµ‹ã€‚

## ğŸ› ï¸ ç¯å¢ƒä¾èµ– (Requirements)

æœ¬é¡¹ç›®åŸºäº Python 3 å¼€å‘ã€‚è¿è¡Œä»£ç å‰ï¼Œè¯·ç¡®ä¿å®‰è£…ä»¥ä¸‹æ ¸å¿ƒåº“ï¼š

  * **PyTorch**: æ·±åº¦å­¦ä¹ æ¡†æ¶æ„å»ºæ¨¡å‹
  * **Baostock**: è·å–ä¸­å›½è‚¡å¸‚å†å²æ•°æ®
  * **Scikit-learn**: æ•°æ®é¢„å¤„ç†ä¸éšæœºæ£®æ—ç®—æ³•
  * **Pandas & Numpy**: æ•°æ®å¤„ç†
  * **Matplotlib**: ç»“æœå¯è§†åŒ–

æ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–ï¼š

```bash
pip install torch pandas numpy scikit-learn matplotlib baostock
```

## ğŸ“‚ ä»£ç ç»“æ„è¯´æ˜ (Code Structure)

Jupyter Notebook (`rf-autoresnls.ipynb`) çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š

### 1\. æ•°æ®è·å–ä¸é¢„å¤„ç† (Data Preprocessing)

  * **æ•°æ®æº**: ä½¿ç”¨ `baostock` API è‡ªåŠ¨ä¸‹è½½ä¸Šè¯ç»¼æŒ‡ (`sh.000001`) çš„å†å² K çº¿æ•°æ®ã€‚
      * *æ—¶é—´èŒƒå›´*: 1992-01-01 è‡³ 2024-01-31ã€‚
      * *ç‰¹å¾*: ä»…ä½¿ç”¨æ”¶ç›˜ä»· (`close`)ã€‚
  * **å½’ä¸€åŒ–**: ä½¿ç”¨ `MinMaxScaler` å°†æ•°æ®ç¼©æ”¾è‡³ `[0, 1]` åŒºé—´ã€‚
  * **åºåˆ—ç”Ÿæˆ**: é‡‡ç”¨æ»‘åŠ¨çª—å£æ³•ï¼Œæ—¶é—´æ­¥é•¿ (Time Step) è®¾ä¸º **5**ã€‚
      * `x`: è¿‡å» 5 ä¸ªäº¤æ˜“æ—¥çš„æ•°æ®ã€‚
      * `y`: ç¬¬ 6 ä¸ªäº¤æ˜“æ—¥çš„æ”¶ç›˜ä»·ã€‚

### 2\. æƒé‡åˆå§‹åŒ– (Weight Initialization via Random Forest)

åœ¨æ„å»ºç¥ç»ç½‘ç»œä¹‹å‰ï¼Œä»£ç é¦–å…ˆè®­ç»ƒä¸€ä¸ª `RandomForestRegressor`ï¼š

  * **ç›®çš„**: è®¡ç®—è¿‡å» 5 å¤©ï¼ˆè¾“å…¥åºåˆ—ï¼‰å¯¹ç¬¬ 6 å¤©ä»·æ ¼çš„ç‰¹å¾é‡è¦æ€§ (Feature Importance)ã€‚
  * **ä½œç”¨**: è¿™äº›æƒé‡è¢«å½’ä¸€åŒ–åï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™ ResNLS æ¨¡å‹ï¼Œç”¨äºåœ¨æ®‹å·®è¿æ¥ä¸­è‡ªé€‚åº”åœ°è°ƒæ•´ CNN æå–ç‰¹å¾çš„æƒé‡ã€‚

### 3\. æ¨¡å‹å®šä¹‰ (Model Architecture)

æ¨¡å‹ç±» `ResNLS` å®šä¹‰åœ¨ PyTorch ä¸­ï¼Œä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†ï¼š

  * **CNN æ®‹å·®æ¨¡å—**:
      * åŒ…å«ä¸¤ä¸ª `Conv1d` å±‚ï¼ˆKernel size=3ï¼‰ã€‚
      * é…åˆ `ReLU` æ¿€æ´»å‡½æ•°ã€`BatchNorm1d` å’Œ `Dropout` (0.2)ã€‚
      * **åˆ›æ–°ç‚¹**: è¿™é‡Œçš„æ®‹å·®è¿æ¥ä¸æ˜¯ç®€å•çš„ç›¸åŠ ï¼Œè€Œæ˜¯ä¹˜ä»¥äº†æ­¥éª¤ 2 ä¸­è®¡ç®—å‡ºçš„ `weight` (è‡ªé€‚åº”æƒé‡)ã€‚
  * **BiLSTM å±‚**:
      * åŒå‘ LSTM (`bidirectional=True`)ï¼Œéšè—å±‚ç»´åº¦ä¸º 32ã€‚
      * ç”¨äºæ•æ‰æ—¶é—´åºåˆ—çš„é•¿çŸ­æœŸä¾èµ–ã€‚
  * **å…¨è¿æ¥å±‚**: è¾“å‡ºæœ€ç»ˆé¢„æµ‹å€¼ã€‚

### 4\. æ¨¡å‹è®­ç»ƒ (Training)

  * **ä¼˜åŒ–å™¨**: Adam (Learning rate = 1e-3, Weight decay = 1e-5)ã€‚
  * **æŸå¤±å‡½æ•°**: MSELoss (å‡æ–¹è¯¯å·®)ã€‚
  * **å­¦ä¹ ç‡è°ƒåº¦**: `ReduceLROnPlateau` (å½“ Loss ä¸å†ä¸‹é™æ—¶è‡ªåŠ¨é™ä½å­¦ä¹ ç‡)ã€‚
  * **å‚æ•°**: Epochs = 50, Batch Size = 64ã€‚

### 5\. éªŒè¯ä¸å¯è§†åŒ– (Validation & Visualization)

  * æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œè¯„ä¼°ã€‚
  * è¾“å‡ºè¯„ä¼°æŒ‡æ ‡ï¼š**MAE**, **MSE**, **RMSE**ã€‚
  * ç»˜åˆ¶æŸå¤±å‡½æ•°æ›²çº¿ (Train vs Validation Loss) å’Œ è‚¡ä»·é¢„æµ‹å¯¹æ¯”å›¾ (Actual vs Predicted)ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹ (Quick Start)

1.  å…‹éš†æœ¬ä»“åº“æˆ–ä¸‹è½½ `rf-autoresnls.ipynb`ã€‚
2.  ç¡®ä¿å·²å®‰è£…ä¸Šè¿°ä¾èµ–åº“ã€‚
3.  ç›´æ¥è¿è¡Œ Jupyter Notebook çš„æ‰€æœ‰å•å…ƒæ ¼ã€‚
      * *æ³¨æ„ï¼šé¦–æ¬¡è¿è¡Œéœ€è¦è”ç½‘ä¸‹è½½ Baostock æ•°æ®ã€‚*

## ğŸ“Š ç»“æœå±•ç¤º (Results)



### é¢„æµ‹æ•ˆæœå¯¹æ¯”

æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„æ‹Ÿåˆæƒ…å†µï¼š

> <img width="1334" height="709" alt="image" src="https://github.com/user-attachments/assets/3b70f005-6352-45a3-ab5a-b446c8c7a649" />


### æ€§èƒ½æŒ‡æ ‡

åœ¨æµ‹è¯•é›†ä¸Šçš„æœ€ç»ˆè¯„ä¼°ç»“æœï¼š

  * **MAE**: \~29.26
  * **MSE**: \~1430.58
  * **RMSE**: \~37.82
    *(æ³¨ï¼šå…·ä½“æ•°å€¼å¯èƒ½å› éšæœºç§å­æˆ–æ•°æ®æ›´æ–°ç•¥æœ‰ä¸åŒ)*

## ğŸ“ æ ¸å¿ƒä»£ç ç‰‡æ®µ

**è‡ªé€‚åº”æƒé‡è®¡ç®— (Random Forest):**

```python
rf = RandomForestRegressor(n_estimators=100, random_state=42)
rf.fit(x_train_5.reshape(-1,5), y_train_5)
weight = rf.feature_importances_
# æƒé‡å½’ä¸€åŒ–å¤„ç†...
```

**ResNLS å‰å‘ä¼ æ’­é€»è¾‘:**

```python
def forward(self, x):
    cnn_output = self.cnn(x)
    cnn_output = cnn_output.view(-1, 1, n_input)
    x = x.view(-1, 1, n_input)
    
    # å…³é”®æ­¥éª¤ï¼šåŠ å…¥è‡ªé€‚åº”æƒé‡çš„æ®‹å·®è¿æ¥
    residuals = x + cnn_output * self.weight 
    
    _, (h_n, _)  = self.lstm(residuals)
    y_hat = self.linear(h_n[0,:,:])
    return y_hat
```

-----

*åŸºäº "åŒºå—é“¾+é‡‘èåˆ›æ–°" æœŸæœ«ä½œä¸šä»£ç æ•´ç†ã€‚*
